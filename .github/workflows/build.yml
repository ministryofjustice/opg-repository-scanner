---
name: "Create build files"

on:
  push:
    branches:
      - "main"

jobs:
  release:
    runs-on: "ubuntu-latest"
    steps:
      - id: date
        name: "Date"
        run: echo "::set-output name=date::$(date +'%Y%m%dT%H%M%S')"
      - name: "Checkout source code"
        uses: "actions/checkout@v2"
        with:
          fetch-depth: 0
      - name: "Run build process"
        run: |
          npm install
          npm run all
      - run: git config --global user.email "tools@digital.justice.gov.uk"
      - run: git config --global user.name "Github Action"
      - run: git checkout -b releases/${{steps.date.outputs.date}}
      - run: git push origin releases/${{steps.date.outputs.date}}
      - run: git add ./dist/ --force
      - run: git commit -m "Build files for release"
      - run: git push origin releases/${{steps.date.outputs.date}}
